description: Set up a python virtual environment to run black, flake8
parameters:
  wd:
    type: string
  pipenv_meta_job_name:
    description: a test job's meta job name for sharing pipenv cache.
    type: string
  pipenv_cache_key_version:
    description: a string that can be changed to bust the pipenv cache.
    type: string
steps:
  - restore_cache:
      keys:
        - >-
          pipenv-{{ checksum "/etc/os-release"
          }}-<<parameters.pipenv_meta_job_name>>-<<parameters.pipenv_cache_key_version>>-{{
          .Branch }}-{{ checksum "Pipfile.lock" }}
        - >-
          pipenv-{{ checksum "/etc/os-release"
          }}-<<parameters.pipenv_meta_job_name>>-<<parameters.pipenv_cache_key_version>>-{{
          .Branch }}
        - >-
          pipenv-{{ checksum "/etc/os-release"
          }}-<<parameters.pipenv_meta_job_name>>-<<parameters.pipenv_cache_key_version>>-main
  - run:
      name: Set up python virtual environment.
      command: |
        cd <<parameters.wd>>
        pipenv sync --dev | cat; test ${PIPESTATUS[0]} -eq 0
  - save_cache:
      paths:
        - ~/.local/share/virtualenvs/
      key: >-
        pipenv-{{ checksum "/etc/os-release"
        }}-<<parameters.pipenv_meta_job_name>>-<<parameters.pipenv_cache_key_version>>-{{
        .Branch }}-{{ checksum "Pipfile.lock" }}
